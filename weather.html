<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="weather.title">Weather Information</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
  <script src="/i18n.js" defer></script>
</head>
<body class="bg-gradient-to-b from-green-100 to-green-300" onload="initI18n()">
  <header>
    <nav class="bg-green-600 text-white p-4">
      <div class="container mx-auto flex justify-between items-center">
        <div class="flex items-center space-x-2">
          <img src="/logo.png" alt="Agro Smart Farming Logo" class="logo">
          <h1 class="navbar-heading" data-i18n="navbar.brand">Agro Smart Farming</h1>
        </div>
        <div class="space-x-4 sm:flex sm:items-center">
          <a href="/dashboard.html" class="hover:underline" data-i18n="navbar.dashboard">Dashboard</a>
          <a href="/weather.html" class="hover:underline" data-i18n="navbar.weather">Weather</a>
          <a href="/recommendation.html" class="hover:underline" data-i18n="navbar.recommendation">Recommendation</a>
          <select id="language-toggle" class="bg-white text-black rounded px-2 py-1" aria-label="Select language">
            <option value="en" data-i18n="navbar.language">English</option>
            <option value="ta" data-i18n="navbar.language">தமிழ்</option>
          </select>
          <button onclick="logout()" class="text-white hover:underline" data-i18n="navbar.logout">Logout</button>
        </div>
      </div>
    </nav>
  </header>

  <main class="container mx-auto mt-6">
    <h1 class="text-2xl font-semibold mb-4" data-i18n="weather.title">Weather Information</h1>
    <div id="weatherDisplay" class="bg-white p-6 rounded-lg shadow-md max-w-md mx-auto">
      <h2 class="text-xl font-semibold mb-2" data-i18n="weather.location" data-i18n-location="location">Weather in <span id="location">N/A</span></h2>
      <div id="weather-error" class="text-red-500 mb-3"></div>
      <img id="weatherIcon" src="" alt="Weather icon" class="mb-3 mx-auto">
      <p data-i18n="weather.temperature" data-i18n-temperature="temperature">Temperature: <span id="temperature">N/A</span>°C</p>
      <p data-i18n="weather.description" data-i18n-description="description">Description: <span id="description">N/A</span></p>
      <p data-i18n="weather.humidity" data-i18n-humidity="humidity">Humidity: <span id="humidity">N/A</span>%</p>
      <p data-i18n="weather.windSpeed" data-i18n-windSpeed="windSpeed">Wind Speed: <span id="windSpeed">N/A</span> m/s</p>
      <p data-i18n="weather.pressure" data-i18n-pressure="pressure">Pressure: <span id="pressure">N/A</span> hPa</p>
      <p data-i18n="weather.sunrise" data-i18n-sunrise="sunrise">Sunrise: <span id="sunrise">N/A</span></p>
      <p data-i18n="weather.sunset" data-i18n-sunset="sunset">Sunset: <span id="sunset">N/A</span></p>
    </div>
  </main>

  <script>
    async function fetchWeather() {
      try {
        const token = localStorage.getItem('token');
        const response = await fetch('/api/weather', {
          headers: { 'Authorization': `Bearer ${token}` },
        });
        const data = await response.json();
        if (response.ok) {
          document.getElementById('weather-error').textContent = '';
          document.getElementById('location').textContent = data.location || t('weather.na');
          document.getElementById('temperature').textContent = data.temperature || t('weather.na');
          document.getElementById('description').textContent = data.description || t('weather.na');
          document.getElementById('humidity').textContent = data.humidity || t('weather.na');
          document.getElementById('windSpeed').textContent = data.windSpeed || t('weather.na');
          document.getElementById('pressure').textContent = data.pressure || t('weather.na');
          document.getElementById('sunrise').textContent = data.sunrise ? new Date(data.sunrise * 1000).toLocaleTimeString() : t('weather.na');
          document.getElementById('sunset').textContent = data.sunset ? new Date(data.sunset * 1000).toLocaleTimeString() : t('weather.na');
          document.getElementById('weatherIcon').src = data.icon ? `http://openweathermap.org/img/wn/${data.icon}.png` : '';
        } else {
          document.getElementById('weather-error').textContent = data.message || t('dashboard.weatherCard.error');
        }
      } catch (err) {
        document.getElementById('weather-error').textContent = t('dashboard.weatherCard.error');
        console.error('Error fetching weather:', err);
      }
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login.html';
    }

    window.addEventListener('load', fetchWeather);
  </script>
</body>
</html>